% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mixcan_train_k.R
\name{MiXcan_train_K}
\alias{MiXcan_train_K}
\title{Estimate cell-type-level prediction weights for a gene (symmetric K-cell MiXcan)}
\usage{
MiXcan_train_K(
  y,
  x,
  cov = NULL,
  pi_k,
  xNameMatrix = NULL,
  yName = NULL,
  foldid = NULL,
  alpha = 0.5
)
}
\arguments{
\item{y}{Numeric vector or N × 1 matrix.
Pre-cleaned expression levels for a single gene in N samples.}

\item{x}{Numeric N × P matrix.
Genotype matrix for cis-SNP predictors of the gene.}

\item{cov}{Optional N × Q matrix of covariates (e.g., age, PCs).
If \code{NULL}, no covariates are included. Default: \code{NULL}.}

\item{pi_k}{Numeric N × K matrix of estimated cell-type fractions for
K cell types. Each row corresponds to a sample, each column to a
cell type. Rows are typically approximately summing to 1.}

\item{xNameMatrix}{Optional SNP annotation (e.g., rsID, position, etc.).
If \code{NULL}, generic names \code{"SNP1", ..., "SNPp"} are used.}

\item{yName}{Optional gene annotation (e.g., gene ID, symbol).}

\item{foldid}{Optional length-N vector of CV fold IDs. If \code{NULL},
10-fold CV with a random split is used.}

\item{alpha}{Elastic-net mixing parameter passed to \code{glmnet}.
Default: \code{0.5}.}
}
\value{
A list with components:
\describe{
\item{type}{Character string: \code{"CellTypeSpecific"}, \code{"NonSpecific"},
or \code{"NoPredictor"}, based on whether contrast SNP effects are present.}
\item{beta.SNP.by.cell}{List of length K; each element is a data.frame
containing SNP annotation and cell-type-specific SNP weights.}
\item{beta.all.models}{Matrix of regression coefficients for the tissue-
level model and K cell-type models (intercepts + SNP + covariates).}
\item{W}{Numeric matrix (SNPs × K) of cell-type-specific SNP weights.
This is the matrix used directly in \code{SMiXcan_assoc_test_K()}.}
\item{glmnet.cell}{Fitted glmnet object for the K-cell model.}
\item{glmnet.tissue}{Fitted glmnet object for the tissue-level model
(ignoring cell-type composition).}
\item{yName}{Returned gene annotation.}
\item{xNameMatrix}{Returned SNP annotation.}
}
}
\description{
This function generalizes the original MiXcan two–cell-type model to
K cell types using a symmetric mean + contrast parameterization.
Gene expression is modeled as a linear combination of:
(i) shared SNP effects across all cell types,
(ii) contrast-coded cell-type effects, and
(iii) SNP-by-contrast interactions.
}
\details{
Elastic-net regression is used with no penalty on the contrast-only
terms corresponding to differences in baseline expression across cell
types, and equal penalization on shared SNP effects and contrast SNP
effects, ensuring symmetric treatment of all cell types.

The model uses a contrast matrix \eqn{C} (by default Helmert contrasts)
of size K × (K-1). For sample i with cell-type fractions \eqn{\pi_{ik}},
contrast-coded compositions are defined as
\deqn{c_i = \pi_i^\top C}
and SNP-by-contrast interactions are constructed as
\deqn{(c_{im} x_{il}), \quad m=1,\dots,K-1; \; l=1,\dots,P.}

The linear predictor is
\deqn{
  y_i = \beta_0 + \sum_{m=1}^{K-1} c_{im} \alpha_m
        + x_i^\top \bar{b}
        + \sum_{m=1}^{K-1} c_{im} x_i^\top d_m
        + z_i^\top \gamma + \varepsilon_i,
}
where \eqn{\bar{b}} is the shared SNP effect, \eqn{d_m} are contrast
effects, and \eqn{z_i} are optional covariates.
Cell-type-specific SNP effects are reconstructed as
\deqn{
  b_k = \bar{b} + \sum_{m=1}^{K-1} C_{km} d_m,
}
ensuring symmetric treatment of all cell types. For K=2, this reduces
to the original MiXcan parameterization up to a constant scaling of
the contrast.
}
